# Mosquitto MQTT Broker Configuration
# For testing PSoC Edge Wi-Fi MQTT Client with wifi-core v3.1.0

# Persistence
persistence true
persistence_location /mosquitto/data/

# Logging
log_dest file /mosquitto/log/mosquitto.log
log_dest stdout
log_type all

# Authentication
allow_anonymous false
password_file /mosquitto/config/password.txt

# =============================================================================
# Listener 1: TLS on port 8884 (matching mqtt_client_config.h)
# =============================================================================
listener 8884
protocol mqtt

# TLS Configuration
cafile /mosquitto/certs/ca.crt
certfile /mosquitto/certs/server.crt
keyfile /mosquitto/certs/server.key

# TLS version - Allow TLS 1.2 and 1.3
tls_version tlsv1.2

# =============================================================================
# Listener 2: mTLS on port 8883 (mutual TLS with OPTIGA Trust M)
# =============================================================================
listener 8883
protocol mqtt

# TLS Configuration for mTLS
cafile /mosquitto/certs/client-ca.crt
certfile /mosquitto/certs/server.crt
keyfile /mosquitto/certs/server.key

# Require client certificate (mTLS)
require_certificate true
use_identity_as_username true

# TLS version
tls_version tlsv1.2

# =============================================================================
# Listener 3: Non-TLS on port 1883 (for debugging)
# =============================================================================
listener 1883
protocol mqtt

# =============================================================================
# Listener 3: WebSocket on port 9001 (optional)
# =============================================================================
listener 9001
protocol websockets
