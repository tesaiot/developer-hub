#!/bin/bash
# commit-msg hook: Prevent Claude attribution in commit messages
# This hook rejects commits containing Claude Code attribution
#
# Installation:
#   git config core.hooksPath .githooks
#
# Or manually:
#   cp .githooks/commit-msg .git/hooks/commit-msg
#   chmod +x .git/hooks/commit-msg

COMMIT_MSG_FILE="$1"
COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# Patterns to detect Claude attribution
PATTERNS=(
    "Co-Authored-By:.*[Cc]laude"
    "Generated with.*[Cc]laude"
    "Claude Code"
    "claude.ai"
    "anthropic.com"
    "ğŸ¤–"
)

# Check each pattern
for pattern in "${PATTERNS[@]}"; do
    if echo "$COMMIT_MSG" | grep -qiE "$pattern"; then
        echo ""
        echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
        echo "â•‘  âŒ COMMIT REJECTED: Claude attribution detected!                â•‘"
        echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
        echo "â•‘  This repository does not allow Claude Code attribution in      â•‘"
        echo "â•‘  commit messages to keep the contributor list clean.            â•‘"
        echo "â•‘                                                                  â•‘"
        echo "â•‘  Detected pattern: $pattern"
        echo "â•‘                                                                  â•‘"
        echo "â•‘  Please remove the following from your commit message:          â•‘"
        echo "â•‘  - 'Co-Authored-By: Claude...'                                   â•‘"
        echo "â•‘  - 'Generated with [Claude Code]...'                             â•‘"
        echo "â•‘  - Any ğŸ¤– emoji                                                  â•‘"
        echo "â•‘  - Any anthropic.com links                                       â•‘"
        echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
        echo ""
        exit 1
    fi
done

exit 0
